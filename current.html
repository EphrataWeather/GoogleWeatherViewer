<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Current Conditions | DEEP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background: radial-gradient(circle at top left, #0f172a, #020617); color: #f1f5f9; font-family: ui-sans-serif, system-ui; overflow-x: hidden; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(24px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.08); }
        .metric-card { background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.04); transition: all 0.2s ease; cursor: pointer; }
        .metric-card:hover { background: rgba(255, 255, 255, 0.05); border-color: rgba(99, 102, 241, 0.4); transform: translateY(-2px); }
        .glow-text { text-shadow: 0 0 20px rgba(99, 102, 241, 0.4); }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        .forecast-scroll { display: flex; overflow-x: auto; gap: 0.75rem; padding-bottom: 0.75rem; }
        .precip-indicator { background: rgba(59, 130, 246, 0.1); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.2); }
        .wind-arrow-container { display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; background: rgba(99, 102, 241, 0.15); border: 2px solid rgba(99, 102, 241, 0.3); border-radius: 50%; }
        #detail-modal { backdrop-filter: blur(12px); background: rgba(2, 6, 23, 0.85); }
    </style>
</head>
<body class="min-h-screen p-4 lg:p-8 flex justify-center">
    <div class="max-w-6xl w-full glass-panel rounded-[2.5rem] overflow-hidden p-6 lg:p-10 space-y-8">
        
        <div class="flex flex-col md:flex-row justify-between items-center gap-8 border-b border-white/5 pb-8">
            <div class="text-center md:text-left">
                <h1 id="location-name" class="text-3xl font-black tracking-tight">Akron, PA</h1>
                <p class="text-[10px] text-indigo-400 uppercase font-bold tracking-[0.2em]">Live Atmospheric Telemetry</p>
            </div>
            <div class="flex items-center gap-8">
                <div id="weather-icon-lg"></div>
                <div class="text-right">
                    <div id="weather-temp" class="text-6xl font-black glow-text mb-1">--Â°</div>
                    <div id="weather-desc" class="text-indigo-300 font-bold uppercase tracking-widest text-[10px]">Syncing...</div>
                    <div id="weather-feels" class="text-[10px] text-slate-500 mt-1 font-bold italic uppercase">--</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
            <div class="xl:col-span-4 space-y-4">
                <h2 class="text-xs font-black uppercase tracking-[0.2em] text-slate-500">Celestial Timing</h2>
                <div class="grid grid-cols-2 gap-2">
                    <div class="p-3 rounded-2xl bg-white/5 border border-white/5 text-center">
                        <i data-lucide="sunrise" class="w-4 h-4 text-orange-400 mx-auto mb-1"></i>
                        <div id="sunrise-time" class="font-bold text-[11px]">--:--</div>
                        <div class="text-[7px] uppercase text-slate-500 font-bold">Sunrise</div>
                    </div>
                    <div class="p-3 rounded-2xl bg-white/5 border border-white/5 text-center">
                        <i data-lucide="sunset" class="w-4 h-4 text-purple-400 mx-auto mb-1"></i>
                        <div id="sunset-time" class="font-bold text-[11px]">--:--</div>
                        <div class="text-[7px] uppercase text-slate-500 font-bold">Sunset</div>
                    </div>
                    <div class="p-3 rounded-2xl bg-white/5 border border-white/5 text-center">
                        <i data-lucide="moon" class="w-4 h-4 text-indigo-300 mx-auto mb-1"></i>
                        <div id="moonrise-time" class="font-bold text-[11px]">--:--</div>
                        <div class="text-[7px] uppercase text-slate-500 font-bold">Moonrise</div>
                    </div>
                    <div class="p-3 rounded-2xl bg-white/5 border border-white/5 text-center">
                        <i data-lucide="moon-star" class="w-4 h-4 text-slate-400 mx-auto mb-1"></i>
                        <div id="moonset-time" class="font-bold text-[11px]">--:--</div>
                        <div class="text-[7px] uppercase text-slate-500 font-bold">Moonset</div>
                    </div>
                    <div class="col-span-2 p-3 rounded-2xl bg-indigo-500/10 border border-indigo-500/20 text-center">
                        <div class="text-[7px] uppercase text-indigo-400 font-bold mb-1">Current Moon Phase</div>
                        <div id="moon-phase" class="text-[10px] font-black uppercase">--</div>
                    </div>
                </div>
            </div>

            <div class="xl:col-span-8 space-y-4">
                <h2 class="text-xs font-black uppercase tracking-[0.2em] text-slate-500">Core Telemetry</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="weather-details-grid">
                    </div>
            </div>
        </div>

        <section>
            <h2 class="text-xs font-black uppercase tracking-[0.2em] text-slate-500 mb-4">24-Hour Micro-Forecast <span class="text-indigo-400 text-[9px] ml-2">TAP FOR ANALYSIS</span></h2>
            <div class="forecast-scroll custom-scrollbar" id="hourly-grid"></div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <section class="lg:col-span-7 p-6 rounded-[2rem] bg-white/5 border border-white/5">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xs font-black uppercase tracking-[0.2em] text-slate-500">Chemical Composition (US EPA)</h2>
                    <div id="aqi-status-badge" class="px-4 py-1.5 rounded-full text-[10px] font-black uppercase">AQI: --</div>
                </div>
                <div id="pollutants-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
            </section>
            <section class="lg:col-span-5">
                <h2 class="text-xs font-black uppercase tracking-[0.2em] text-slate-500 mb-4">Plant Allergens</h2>
                <div id="pollen-types-list" class="space-y-3"></div>
            </section>
        </div>
    </div>

    <div id="detail-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-6">
        <div class="max-w-2xl w-full glass-panel rounded-[2rem] p-8 border border-white/20 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-6 right-6 text-slate-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div id="modal-content" class="space-y-6"></div>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyBAjoVkrRrLPzv9MSrlWaWTFELT8KpJ41E"; // Insert Key
        const LAT = 40.1579; const LNG = -76.2047;
        let globalHourly = [];

        async function init() {
            try {
                const endpoints = {
                    weather: `https://weather.googleapis.com/v1/currentConditions:lookup?location.latitude=${LAT}&location.longitude=${LNG}&unitsSystem=IMPERIAL&key=${API_KEY}`,
                    aqi: `https://airquality.googleapis.com/v1/currentConditions:lookup?key=${API_KEY}`,
                    pollen: `https://pollen.googleapis.com/v1/forecast:lookup?location.latitude=${LAT}&location.longitude=${LNG}&days=1&key=${API_KEY}`,
                    hourly: `https://weather.googleapis.com/v1/forecast/hours:lookup?location.latitude=${LAT}&location.longitude=${LNG}&unitsSystem=IMPERIAL&hours=24&key=${API_KEY}`,
                    daily: `https://weather.googleapis.com/v1/forecast/days:lookup?location.latitude=${LAT}&location.longitude=${LNG}&unitsSystem=IMPERIAL&days=1&key=${API_KEY}`
                };

                const [wRes, aRes, pRes, hRes, dRes] = await Promise.all([
                    fetch(endpoints.weather),
                    fetch(endpoints.aqi, { method: 'POST', body: JSON.stringify({ location: { latitude: LAT, longitude: LNG }, extraComputations: ["POLLUTANT_CONCENTRATION"]}) }),
                    fetch(endpoints.pollen),
                    fetch(endpoints.hourly),
                    fetch(endpoints.daily)
                ]);

                const weather = await wRes.json();
                const aqi = await aRes.json();
                const pollen = await pRes.json();
                const hourly = await hRes.json();
                const daily = await dRes.json();
                globalHourly = hourly.forecastHours || [];

                render(weather, aqi, pollen, hourly, daily.forecastDays[0]);
            } catch (e) { console.error(e); }
        }

        const findValue = (obj, keys, defaultVal = 0) => {
            for (let key of keys) {
                const parts = key.split('.');
                let current = obj;
                for (let p of parts) { current = (current && typeof current === 'object') ? current[p] : undefined; }
                if (current !== undefined && current !== null) return current;
            }
            return defaultVal;
        };

        const calculateAccumulation = (liquidQpf, type) => {
            const liquid = parseFloat(liquidQpf) || 0;
            const precipType = (type || "").toUpperCase();
            if (precipType.includes("SNOW")) return (liquid * 10).toFixed(2);
            if (precipType.includes("SLEET") || precipType.includes("ICE")) return (liquid * 3).toFixed(2);
            return liquid.toFixed(2);
        };

        function getWeatherIcon(desc, isoTime, isDaytime = true) {
            const d = (desc || "").toLowerCase();
            if (d.includes('rain') || d.includes('drizzle')) return 'cloud-rain';
            if (d.includes('thunder')) return 'cloud-lightning';
            if (d.includes('snow') || d.includes('ice')) return 'cloud-snow';
            if (d.includes('cloud') || d.includes('overcast')) return 'cloud';
            if (d.includes('fog') || d.includes('mist')) return 'cloud-fog';
            return isDaytime ? 'sun' : 'moon';
        }

        function render(w, a, p, h, d) {
            const desc = findValue(w, ['weatherCondition.description.text'], "Clear");
            const isDay = w.isDaytime ?? true;
            document.getElementById('weather-temp').innerText = `${Math.round(w.temperature.degrees)}Â°`;
            document.getElementById('weather-desc').innerText = desc;
            document.getElementById('weather-feels').innerText = `Perceived: ${Math.round(w.feelsLikeTemperature.degrees)}Â°`;
            document.getElementById('weather-icon-lg').innerHTML = `<i data-lucide="${getWeatherIcon(desc, null, isDay)}" class="w-12 h-12 text-slate-300"></i>`;

            // Solar/Lunar
            const sun = d.sunEvents || {};
            const moon = d.moonEvents || {};
            document.getElementById('sunrise-time').innerText = formatTime(sun.sunriseTime);
            document.getElementById('sunset-time').innerText = formatTime(sun.sunsetTime);
            document.getElementById('moonrise-time').innerText = formatTime(moon.moonriseTimes?.[0]);
            document.getElementById('moonset-time').innerText = formatTime(moon.moonsetTimes?.[0]);
            document.getElementById('moon-phase').innerText = (moon.moonPhase || 'N/A').replace(/_/g, ' ');

            // Core Metrics
            const mb = findValue(w, ['airPressure.meanSeaLevelMillibars'], 0);
            const inHg = (mb * 0.02953).toFixed(2);
            const visMiles = (findValue(w, ['visibility.distance']) * 0.621).toFixed(1);
            
            const metrics = [
                { label: 'Wind/Gusts', val: `${Math.round(w.wind.speed.value)} / ${Math.round(w.wind.gust.value)} mph`, icon: 'wind', color: 'text-indigo-400' },
                { label: 'Humidity', val: `${w.relativeHumidity}%`, icon: 'droplets', color: 'text-blue-400' },
                { label: 'Pressure', val: `${inHg} in`, icon: 'gauge', color: 'text-emerald-400' },
                { label: 'Visibility', val: `${visMiles} mi`, icon: 'eye', color: 'text-slate-400' },
                { label: 'UV Index', val: w.uvIndex, icon: 'sun', color: 'text-yellow-400' }
            ];
            document.getElementById('weather-details-grid').innerHTML = metrics.map(m => `
                <div class="p-4 rounded-2xl bg-white/5 border border-white/5 metric-card flex items-center gap-3">
                    <i data-lucide="${m.icon}" class="w-4 h-4 ${m.color}"></i>
                    <div><div class="text-[9px] font-black text-slate-500 uppercase">${m.label}</div><div class="text-sm font-bold text-white">${m.val}</div></div>
                </div>`).join('');

            // Hourly
            document.getElementById('hourly-grid').innerHTML = globalHourly.map((hour, i) => {
                const hDesc = findValue(hour, ['weatherCondition.description.text']);
                return `
                <div onclick="showHourlyDetail(${i})" class="min-w-[130px] p-4 rounded-2xl bg-white/5 border border-white/5 text-center metric-card">
                    <div class="text-[9px] text-slate-500 font-bold mb-2">${formatTime(hour.interval.startTime)}</div>
                    <i data-lucide="${getWeatherIcon(hDesc, null, hour.isDaytime)}" class="w-5 h-5 mx-auto mb-2 text-slate-400"></i>
                    <div class="text-lg font-black mb-1">${Math.round(hour.temperature.degrees)}Â°</div>
                    <div class="text-[8px] text-indigo-400 font-bold uppercase truncate mb-2">${hDesc}</div>
                    <div class="precip-indicator px-2 py-0.5 rounded-full text-[8px] font-black inline-block">${hour.precipitationProbability || 0}% ðŸ’§</div>
                </div>`;
            }).join('');

            // AQI (US EPA)
            const aqiIdx = a.indexes.find(i => i.code === 'usa_epa') || a.indexes[0];
            const badge = document.getElementById('aqi-status-badge');
            badge.innerText = `AQI: ${aqiIdx.aqi} (${aqiIdx.category})`;
            badge.className = `px-4 py-1.5 rounded-full text-[10px] font-black uppercase ${aqiIdx.category.toLowerCase().includes('good') ? 'bg-emerald-500/20 text-emerald-400' : 'bg-yellow-500/20 text-yellow-400'}`;

            document.getElementById('pollutants-grid').innerHTML = (a.pollutants || []).map(p => `
                <div class="p-4 rounded-xl bg-black/30 border border-white/5 text-center">
                    <div class="text-[8px] font-black text-slate-500 uppercase mb-2">${p.displayName}</div>
                    <div class="font-bold text-xs">${Math.round(p.concentration.value)}</div>
                </div>`).join('');

            // Pollen
            const pData = p.dailyInfo[0].pollenTypeInfo || [];
            document.getElementById('pollen-types-list').innerHTML = pData.map(t => `
                <div class="p-4 rounded-2xl bg-white/5 border border-white/5 metric-card">
                    <div class="flex justify-between text-[10px] font-black uppercase mb-2"><span>${t.displayName}</span><span class="text-indigo-400">${t.indexInfo.value}/5</span></div>
                    <div class="w-full bg-white/10 h-1.5 rounded-full overflow-hidden"><div class="bg-indigo-500 h-full" style="width: ${(t.indexInfo.value/5)*100}%"></div></div>
                </div>`).join('');

            lucide.createIcons();
        }

        function showHourlyDetail(index) {
            const h = globalHourly[index];
            const time = formatTime(h.interval.startTime);
            const desc = findValue(h, ['weatherCondition.description.text']);
            const pAmt = calculateAccumulation(findValue(h, ['precipitationAmount']), findValue(h, ['precipitationProbabilityType']));
            
            document.getElementById('modal-content').innerHTML = `
                <div class="flex items-center gap-4 border-b border-white/10 pb-4">
                    <i data-lucide="${getWeatherIcon(desc, null, h.isDaytime)}" class="w-10 h-10 text-indigo-400"></i>
                    <div><h3 class="text-2xl font-black text-white">${time} Detail</h3><p class="text-indigo-400 font-bold uppercase text-[10px]">${desc} | ${Math.round(h.temperature.degrees)}Â°</p></div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                    <div><div class="text-[10px] font-black text-slate-500 uppercase">Precipitation</div><div class="text-xl font-bold">${h.precipitationProbability}% <span class="text-xs text-blue-400">(${pAmt}")</span></div></div>
                    <div><div class="text-[10px] font-black text-slate-500 uppercase">Wind / Gust</div><div class="text-xl font-bold">${Math.round(h.wind.speed.value)} / ${Math.round(h.wind.gust.value)} <span class="text-xs">mph</span></div></div>
                    <div><div class="text-[10px] font-black text-slate-500 uppercase">Feels Like</div><div class="text-xl font-bold">${Math.round(h.feelsLikeTemperature.degrees)}Â°</div></div>
                    <div><div class="text-[10px] font-black text-slate-500 uppercase">Humidity</div><div class="text-xl font-bold">${h.relativeHumidity}%</div></div>
                    <div><div class="text-[10px] font-black text-slate-500 uppercase">UV Index</div><div class="text-xl font-bold">${h.uvIndex}</div></div>
                </div>`;
            document.getElementById('detail-modal').classList.replace('hidden', 'flex');
            lucide.createIcons();
        }

        function closeModal() { document.getElementById('detail-modal').classList.replace('flex', 'hidden'); }
        function formatTime(iso) { return iso ? new Date(iso).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true }) : "--:--"; }
        
        window.onload = init;
    </script>
</body>
</html>
